<VirtualHost *:80>
    ServerName aajminpolyclinic.com.np
    ServerAlias www.aajminpolyclinic.com.np
    
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    ServerName aajminpolyclinic.com.np
    ServerAlias www.aajminpolyclinic.com.np
    
    SSLEngine on
    SSLCertificateFile "/opt/bitnami/apache/conf/bitnami/certs/tls.crt"
    SSLCertificateKeyFile "/opt/bitnami/apache/conf/bitnami/certs/tls.key"
    
    # Enable required modules
    ProxyPreserveHost On
    ProxyRequests Off
    
    # WebSocket support for Next.js HMR
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*) ws://localhost:3002/$1 [P,L]
    
    # Proxy all requests to Next.js
    ProxyPass / http://localhost:3002/ nocanon
    ProxyPassReverse / http://localhost:3002/
    
    # Allow encoded slashes
    AllowEncodedSlashes NoDecode
    
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options SAMEORIGIN
    Header always set X-XSS-Protection "1; mode=block"
    
    ErrorLog "/opt/bitnami/apache/logs/hospital-frontend_error.log"
    CustomLog "/opt/bitnami/apache/logs/hospital-frontend_access.log" combined
</VirtualHost>
